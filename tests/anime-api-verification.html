<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anime.js V4 API Verification</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #1a1a2e;
      color: #eee;
      padding: 20px;
      line-height: 1.6;
    }
    h1 { color: #8b5cf6; margin-bottom: 30px; }
    h2 { color: #a78bfa; margin-top: 40px; border-bottom: 1px solid #333; padding-bottom: 8px; }

    .test-section {
      background: #16213e;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .test-section h3 {
      margin-top: 0;
      color: #c4b5fd;
    }

    .test-area {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
      min-height: 120px;
      background: #0f0f23;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
    }

    .box {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }

    .card {
      width: 80px;
      height: 120px;
      background: linear-gradient(145deg, #1e3a5f, #0d1b2a);
      border: 2px solid #8b5cf6;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      text-align: center;
      color: #a78bfa;
    }

    .text-container {
      font-size: 18px;
      color: #e2e8f0;
    }
    .text-container span {
      display: inline-block;
    }

    button {
      background: #8b5cf6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }
    button:hover {
      background: #7c3aed;
    }
    button:disabled {
      background: #4c4c6d;
      cursor: not-allowed;
    }

    .result {
      margin-top: 10px;
      padding: 10px;
      background: #0d1b2a;
      border-radius: 6px;
      font-family: monospace;
      font-size: 13px;
      white-space: pre-wrap;
    }
    .result.success { border-left: 3px solid #22c55e; }
    .result.error { border-left: 3px solid #ef4444; }
    .result.pending { border-left: 3px solid #eab308; }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <h1>Anime.js V4 API Verification Tests</h1>
  <p>Run these tests to verify API behavior before migration.</p>

  <!-- Test 1: Basic animate() -->
  <div class="test-section">
    <h3>Test 1: Basic animate() with transforms</h3>
    <p>Verify: translateX, rotate, scale, opacity with easing</p>
    <div class="controls">
      <button onclick="runTest1()">Run Test</button>
      <button onclick="resetTest1()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test1-box">1</div>
    </div>
    <div class="result pending" id="test1-result">Pending...</div>
  </div>

  <!-- Test 2: CSS filter animation -->
  <div class="test-section">
    <h3>Test 2: CSS filter property (blur)</h3>
    <p>Verify: Can we animate filter: blur()?</p>
    <div class="controls">
      <button onclick="runTest2()">Run Test</button>
      <button onclick="resetTest2()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test2-box">2</div>
    </div>
    <div class="result pending" id="test2-result">Pending...</div>
  </div>

  <!-- Test 3: Spring easing -->
  <div class="test-section">
    <h3>Test 3: Spring physics easing</h3>
    <p>Verify: easing: 'spring(mass, stiffness, damping, velocity)'</p>
    <div class="controls">
      <button onclick="runTest3()">Run Test</button>
      <button onclick="resetTest3()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test3-box">3</div>
    </div>
    <div class="result pending" id="test3-result">Pending...</div>
  </div>

  <!-- Test 4: Stagger -->
  <div class="test-section">
    <h3>Test 4: Stagger animation</h3>
    <p>Verify: stagger(delay, { from: 'center' })</p>
    <div class="controls">
      <button onclick="runTest4()">Run Test</button>
      <button onclick="resetTest4()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test4-box-1">1</div>
      <div class="box" id="test4-box-2">2</div>
      <div class="box" id="test4-box-3">3</div>
      <div class="box" id="test4-box-4">4</div>
      <div class="box" id="test4-box-5">5</div>
    </div>
    <div class="result pending" id="test4-result">Pending...</div>
  </div>

  <!-- Test 5: Timeline -->
  <div class="test-section">
    <h3>Test 5: Timeline sequencing</h3>
    <p>Verify: timeline().add() with position offsets</p>
    <div class="controls">
      <button onclick="runTest5()">Run Test</button>
      <button onclick="resetTest5()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test5-box-1">A</div>
      <div class="box" id="test5-box-2">B</div>
      <div class="box" id="test5-box-3">C</div>
    </div>
    <div class="result pending" id="test5-result">Pending...</div>
  </div>

  <!-- Test 6: Promise -->
  <div class="test-section">
    <h3>Test 6: Promise-based completion</h3>
    <p>Verify: animation.promise and async/await</p>
    <div class="controls">
      <button onclick="runTest6()">Run Test</button>
      <button onclick="resetTest6()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test6-box">6</div>
    </div>
    <div class="result pending" id="test6-result">Pending...</div>
  </div>

  <!-- Test 7: Function-based values -->
  <div class="test-section">
    <h3>Test 7: Per-element function values</h3>
    <p>Verify: translateX: (el, i) => i * 50</p>
    <div class="controls">
      <button onclick="runTest7()">Run Test</button>
      <button onclick="resetTest7()">Reset</button>
    </div>
    <div class="test-area">
      <div class="card" id="test7-card-0">Card 0</div>
      <div class="card" id="test7-card-1">Card 1</div>
      <div class="card" id="test7-card-2">Card 2</div>
      <div class="card" id="test7-card-3">Card 3</div>
    </div>
    <div class="result pending" id="test7-result">Pending...</div>
  </div>

  <!-- Test 8: utils.splitText -->
  <div class="test-section">
    <h3>Test 8: utils.splitText</h3>
    <p>Verify: Text splitting for word-by-word animation</p>
    <div class="controls">
      <button onclick="runTest8()">Run Test</button>
      <button onclick="resetTest8()">Reset</button>
    </div>
    <div class="test-area">
      <div class="text-container" id="test8-text">The cards reveal your path forward.</div>
    </div>
    <div class="result pending" id="test8-result">Pending...</div>
  </div>

  <!-- Test 9: utils.set -->
  <div class="test-section">
    <h3>Test 9: utils.set (instant property setting)</h3>
    <p>Verify: Set CSS properties without animation</p>
    <div class="controls">
      <button onclick="runTest9()">Run Test</button>
      <button onclick="resetTest9()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test9-box">9</div>
    </div>
    <div class="result pending" id="test9-result">Pending...</div>
  </div>

  <!-- Test 10: Keyframes -->
  <div class="test-section">
    <h3>Test 10: Keyframes animation</h3>
    <p>Verify: keyframes array syntax</p>
    <div class="controls">
      <button onclick="runTest10()">Run Test</button>
      <button onclick="resetTest10()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test10-box">10</div>
    </div>
    <div class="result pending" id="test10-result">Pending...</div>
  </div>

  <!-- Test 11: Playback controls -->
  <div class="test-section">
    <h3>Test 11: Playback controls</h3>
    <p>Verify: play(), pause(), restart(), reverse(), seek()</p>
    <div class="controls">
      <button onclick="runTest11()">Start</button>
      <button onclick="test11Pause()">Pause</button>
      <button onclick="test11Play()">Play</button>
      <button onclick="test11Reverse()">Reverse</button>
      <button onclick="test11Seek()">Seek 50%</button>
      <button onclick="test11Restart()">Restart</button>
    </div>
    <div class="test-area">
      <div class="box" id="test11-box">11</div>
    </div>
    <div class="result pending" id="test11-result">Pending...</div>
  </div>

  <!-- Test 12: Callbacks -->
  <div class="test-section">
    <h3>Test 12: Lifecycle callbacks</h3>
    <p>Verify: onBegin, onUpdate, onComplete, onLoop</p>
    <div class="controls">
      <button onclick="runTest12()">Run Test</button>
      <button onclick="resetTest12()">Reset</button>
    </div>
    <div class="test-area">
      <div class="box" id="test12-box">12</div>
    </div>
    <div class="result pending" id="test12-result">Pending...</div>
  </div>

  <!-- Load Anime.js from CDN -->
  <script type="module">
    // Import Anime.js
    import anime from 'https://cdn.jsdelivr.net/npm/animejs@3.2.2/lib/anime.es.js';

    // Make available globally for onclick handlers
    window.anime = anime;

    // Store animation instances for playback control tests
    window.testAnimations = {};

    // Helper to update result
    window.setResult = (id, status, message) => {
      const el = document.getElementById(id);
      el.className = `result ${status}`;
      el.textContent = message;
    };

    // ========== TEST 1: Basic animate ==========
    window.runTest1 = () => {
      try {
        const anim = anime({
          targets: '#test1-box',
          translateX: 250,
          rotate: '1turn',
          scale: 1.2,
          opacity: [1, 0.5, 1],
          duration: 1000,
          easing: 'easeInOutQuad'
        });
        setResult('test1-result', 'success', 'SUCCESS: Basic animate() works\nUsed: translateX, rotate, scale, opacity, easing');
      } catch (e) {
        setResult('test1-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest1 = () => {
      anime.set('#test1-box', { translateX: 0, rotate: 0, scale: 1, opacity: 1 });
      setResult('test1-result', 'pending', 'Reset');
    };

    // ========== TEST 2: CSS filter ==========
    window.runTest2 = () => {
      try {
        anime({
          targets: '#test2-box',
          filter: ['blur(0px)', 'blur(10px)', 'blur(0px)'],
          duration: 1500,
          easing: 'easeInOutQuad',
          complete: () => {
            setResult('test2-result', 'success', 'SUCCESS: CSS filter animation works!\nfilter: blur() is animatable');
          }
        });
        setResult('test2-result', 'pending', 'Running filter animation...');
      } catch (e) {
        setResult('test2-result', 'error', `ERROR: ${e.message}\nCSS filter may not be supported`);
      }
    };
    window.resetTest2 = () => {
      anime.set('#test2-box', { filter: 'blur(0px)' });
      setResult('test2-result', 'pending', 'Reset');
    };

    // ========== TEST 3: Spring easing ==========
    window.runTest3 = () => {
      try {
        anime({
          targets: '#test3-box',
          translateX: 200,
          easing: 'spring(1, 80, 10, 0)', // mass, stiffness, damping, velocity
          complete: () => {
            setResult('test3-result', 'success', 'SUCCESS: Spring easing works!\neasing: "spring(1, 80, 10, 0)"');
          }
        });
        setResult('test3-result', 'pending', 'Running spring animation...');
      } catch (e) {
        setResult('test3-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest3 = () => {
      anime.set('#test3-box', { translateX: 0 });
      setResult('test3-result', 'pending', 'Reset');
    };

    // ========== TEST 4: Stagger ==========
    window.runTest4 = () => {
      try {
        anime({
          targets: '[id^="test4-box-"]',
          translateY: [-30, 0],
          opacity: [0, 1],
          scale: [0.5, 1],
          delay: anime.stagger(100, { from: 'center' }),
          duration: 600,
          easing: 'easeOutElastic(1, .5)',
          complete: () => {
            setResult('test4-result', 'success', 'SUCCESS: Stagger works!\ndelay: anime.stagger(100, { from: "center" })');
          }
        });
        setResult('test4-result', 'pending', 'Running stagger animation...');
      } catch (e) {
        setResult('test4-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest4 = () => {
      anime.set('[id^="test4-box-"]', { translateY: 0, opacity: 1, scale: 1 });
      setResult('test4-result', 'pending', 'Reset');
    };

    // ========== TEST 5: Timeline ==========
    window.runTest5 = () => {
      try {
        const tl = anime.timeline({
          easing: 'easeOutExpo',
          duration: 500
        });

        tl.add({
          targets: '#test5-box-1',
          translateX: 150,
          backgroundColor: '#22c55e'
        })
        .add({
          targets: '#test5-box-2',
          translateX: 150,
          backgroundColor: '#eab308'
        }, '-=300') // Overlap by 300ms
        .add({
          targets: '#test5-box-3',
          translateX: 150,
          backgroundColor: '#ef4444'
        }, '-=300');

        tl.finished.then(() => {
          setResult('test5-result', 'success', 'SUCCESS: Timeline works!\nUsed: .add() with "-=300" offset for overlap');
        });
        setResult('test5-result', 'pending', 'Running timeline...');
      } catch (e) {
        setResult('test5-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest5 = () => {
      anime.set('[id^="test5-box-"]', { translateX: 0, backgroundColor: '' });
      setResult('test5-result', 'pending', 'Reset');
    };

    // ========== TEST 6: Promise ==========
    window.runTest6 = async () => {
      try {
        setResult('test6-result', 'pending', 'Starting async animation...');

        const anim = anime({
          targets: '#test6-box',
          translateX: 100,
          duration: 500,
          easing: 'easeOutQuad'
        });

        // Test .finished promise
        await anim.finished;

        const anim2 = anime({
          targets: '#test6-box',
          translateY: 30,
          duration: 500,
          easing: 'easeOutQuad'
        });

        await anim2.finished;

        setResult('test6-result', 'success', 'SUCCESS: Promise works!\nUsed: await animation.finished');
      } catch (e) {
        setResult('test6-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest6 = () => {
      anime.set('#test6-box', { translateX: 0, translateY: 0 });
      setResult('test6-result', 'pending', 'Reset');
    };

    // ========== TEST 7: Function values ==========
    window.runTest7 = () => {
      try {
        anime({
          targets: '[id^="test7-card-"]',
          translateX: (el, i) => i * 30 - 45, // Spread cards
          translateY: (el, i) => Math.abs(i - 1.5) * -15, // Arc shape
          rotate: (el, i) => (i - 1.5) * 8, // Fan rotation
          scale: (el, i) => 1 - Math.abs(i - 1.5) * 0.05,
          duration: 800,
          easing: 'easeOutQuart',
          delay: anime.stagger(50),
          complete: () => {
            setResult('test7-result', 'success', 'SUCCESS: Function values work!\ntranslateX: (el, i) => i * 30 - 45\nCreated card fan effect');
          }
        });
        setResult('test7-result', 'pending', 'Running function-based animation...');
      } catch (e) {
        setResult('test7-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest7 = () => {
      anime.set('[id^="test7-card-"]', { translateX: 0, translateY: 0, rotate: 0, scale: 1 });
      setResult('test7-result', 'pending', 'Reset');
    };

    // ========== TEST 8: utils.splitText ==========
    window.runTest8 = () => {
      try {
        // Check if utils.splitText exists
        if (typeof anime.utils?.splitText === 'function') {
          const chars = anime.utils.splitText('#test8-text', { by: 'word' });
          anime({
            targets: chars,
            opacity: [0, 1],
            translateY: [20, 0],
            delay: anime.stagger(80),
            duration: 400,
            easing: 'easeOutQuad'
          });
          setResult('test8-result', 'success', 'SUCCESS: utils.splitText() works!');
        } else {
          // Fallback: manual text splitting
          const container = document.getElementById('test8-text');
          const text = container.textContent;
          // Escape HTML to prevent XSS
          const escapeHtml = (str) => str.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]);
          container.innerHTML = text.split(' ').map(word =>
            `<span style="display:inline-block;opacity:0">${escapeHtml(word)}&nbsp;</span>`
          ).join('');

          anime({
            targets: '#test8-text span',
            opacity: [0, 1],
            translateY: [20, 0],
            delay: anime.stagger(80),
            duration: 400,
            easing: 'easeOutQuad',
            complete: () => {
              setResult('test8-result', 'success', 'NOTE: utils.splitText not found in this version\nUsed manual text splitting as fallback\n\nFor V4, may need different import or manual split');
            }
          });
        }
      } catch (e) {
        setResult('test8-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest8 = () => {
      document.getElementById('test8-text').innerHTML = 'The cards reveal your path forward.';
      setResult('test8-result', 'pending', 'Reset');
    };

    // ========== TEST 9: utils.set ==========
    window.runTest9 = () => {
      try {
        // Test anime.set (should work in v3)
        anime.set('#test9-box', {
          translateX: 100,
          rotate: 45,
          scale: 1.3,
          backgroundColor: '#22c55e'
        });
        setResult('test9-result', 'success', 'SUCCESS: anime.set() works!\nInstantly set: translateX, rotate, scale, backgroundColor');
      } catch (e) {
        setResult('test9-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest9 = () => {
      anime.set('#test9-box', { translateX: 0, rotate: 0, scale: 1, backgroundColor: '' });
      setResult('test9-result', 'pending', 'Reset');
    };

    // ========== TEST 10: Keyframes ==========
    window.runTest10 = () => {
      try {
        anime({
          targets: '#test10-box',
          keyframes: [
            { translateX: 0, translateY: 0, rotate: 0 },
            { translateX: 100, translateY: -30, rotate: 45 },
            { translateX: 200, translateY: 0, rotate: 90 },
            { translateX: 100, translateY: 30, rotate: 135 },
            { translateX: 0, translateY: 0, rotate: 180 }
          ],
          duration: 2000,
          easing: 'easeInOutSine',
          complete: () => {
            setResult('test10-result', 'success', 'SUCCESS: Keyframes work!\nUsed: keyframes array with 5 states');
          }
        });
        setResult('test10-result', 'pending', 'Running keyframes animation...');
      } catch (e) {
        setResult('test10-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest10 = () => {
      anime.set('#test10-box', { translateX: 0, translateY: 0, rotate: 0 });
      setResult('test10-result', 'pending', 'Reset');
    };

    // ========== TEST 11: Playback controls ==========
    window.runTest11 = () => {
      try {
        window.testAnimations.test11 = anime({
          targets: '#test11-box',
          translateX: 300,
          duration: 3000,
          easing: 'linear',
          autoplay: true,
          update: (anim) => {
            setResult('test11-result', 'pending', `Progress: ${Math.round(anim.progress)}%`);
          },
          complete: () => {
            setResult('test11-result', 'success', 'Animation complete!');
          }
        });
      } catch (e) {
        setResult('test11-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.test11Pause = () => {
      window.testAnimations.test11?.pause();
      setResult('test11-result', 'pending', 'Paused');
    };
    window.test11Play = () => {
      window.testAnimations.test11?.play();
    };
    window.test11Reverse = () => {
      window.testAnimations.test11?.reverse();
      setResult('test11-result', 'pending', 'Reversed direction');
    };
    window.test11Seek = () => {
      window.testAnimations.test11?.seek(1500); // 50% of 3000ms
      setResult('test11-result', 'pending', 'Seeked to 50%');
    };
    window.test11Restart = () => {
      window.testAnimations.test11?.restart();
    };

    // ========== TEST 12: Callbacks ==========
    window.runTest12 = () => {
      const logs = [];
      try {
        anime({
          targets: '#test12-box',
          translateX: [0, 150, 0],
          duration: 1500,
          easing: 'easeInOutQuad',
          loop: 2,
          begin: (anim) => {
            logs.push('onBegin fired');
            setResult('test12-result', 'pending', logs.join('\n'));
          },
          update: (anim) => {
            if (Math.round(anim.progress) % 25 === 0) {
              const msg = `onUpdate: ${Math.round(anim.progress)}%`;
              if (!logs.includes(msg)) {
                logs.push(msg);
                setResult('test12-result', 'pending', logs.join('\n'));
              }
            }
          },
          loopComplete: (anim) => {
            logs.push(`onLoop fired (iteration ${anim.currentLoop})`);
            setResult('test12-result', 'pending', logs.join('\n'));
          },
          complete: (anim) => {
            logs.push('onComplete fired');
            setResult('test12-result', 'success', 'SUCCESS: All callbacks work!\n\n' + logs.join('\n'));
          }
        });
      } catch (e) {
        setResult('test12-result', 'error', `ERROR: ${e.message}`);
      }
    };
    window.resetTest12 = () => {
      anime.set('#test12-box', { translateX: 0 });
      setResult('test12-result', 'pending', 'Reset');
    };

    // Initial message
    console.log('Anime.js loaded:', anime);
    console.log('Version check - anime.version:', anime.version);
  </script>
</body>
</html>
