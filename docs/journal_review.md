# Journal Feature Review

- **Storage & Sync** — `useJournal` automatically routes anonymous users to `localStorage` (capped at 100 entries) while authenticated users hit the D1 API with optimistic updates, cached fallbacks, archetype tracking, and deduped migrations that preserve original timestamps via `timestampMs`. (src/hooks/useJournal.js:16, src/hooks/useJournal.js:30, src/hooks/useJournal.js:113, src/hooks/useJournal.js:215, src/hooks/useJournal.js:263)
- **UX Flow** — `src/components/Journal.jsx` layers contextual filters (query, contexts, spreads, decks, timeframe, reversal-only), paged rendering, delete feedback, an empty-state explainer, and auth-aware migration/share affordances so users see value before entries exist. (src/components/Journal.jsx:34, src/components/Journal.jsx:63, src/components/Journal.jsx:173, src/components/Journal.jsx:244, src/components/Journal.jsx:296, src/components/Journal.jsx:370, src/components/Journal.jsx:420)
- **Insights & Sharing** — `JournalInsightsPanel` combines CSV/PDF/“visual card” exports, anonymous snapshot copying, authenticated share-link creation (filtered previews, expiry controls, link management), and auto-generated coach prompts keyed to top contexts/themes/cards. (src/components/JournalInsightsPanel.jsx:88, src/components/JournalInsightsPanel.jsx:182, src/components/JournalInsightsPanel.jsx:212, src/components/JournalInsightsPanel.jsx:273, src/components/JournalInsightsPanel.jsx:340, src/components/JournalInsightsPanel.jsx:370, src/components/JournalInsightsPanel.jsx:509, src/components/JournalInsightsPanel.jsx:648)
- **Data Helpers** — `src/lib/journalInsights.js` centralizes stats caching, CSV building/export, clipboard fallbacks, share-token history, and “coach recommendation” persistence with TTLs that feed both insights and intention-coach flows. (src/lib/journalInsights.js:11, src/lib/journalInsights.js:20, src/lib/journalInsights.js:94, src/lib/journalInsights.js:162, src/lib/journalInsights.js:223, src/lib/journalInsights.js:257, src/lib/journalInsights.js:304, src/lib/journalInsights.js:349)
- **Server Capabilities** — `/functions/api/journal*.js` enforce session cookies, serialize card/theme/reflection blobs, honor sanitized client timestamps, verify ownership before deletes, and `/functions/api/journal-summary.js` can batch up to 10 entries for Azure Responses (with heuristic fallback) to return narrated recaps. (functions/api/journal.js:16, functions/api/journal.js:33, functions/api/journal.js:86, functions/api/journal.js:107, functions/api/journal.js:153, functions/api/journal/[id].js:15, functions/api/journal-summary.js:1, functions/api/journal-summary.js:95, functions/api/journal-summary.js:157)
- **Community Gaps** — Today’s filters, share limits (10 entries max), and coach snapshots are strictly individual; there is no native surface for collaborative prompts, group annotations, or peer discovery, which is key context before layering community-centered features.
