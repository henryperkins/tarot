# ============================================================================
# Cloudflare Pages Configuration - Mystic Tarot
# ============================================================================
# This file is the SOURCE OF TRUTH for your Pages project configuration.
# Ref: https://developers.cloudflare.com/pages/functions/wrangler-configuration/
#
name = "mystic-tarot"
compatibility_date = "2025-01-13"
pages_build_output_dir = "dist"

# ============================================================================
# Environment Variables (Non-Secret)
# ============================================================================
# These are SAFE to commit to git. For sensitive data, use secrets instead.
# Ref: https://developers.cloudflare.com/pages/functions/bindings/#environment-variables
#
[vars]
AZURE_OPENAI_API_VERSION = "preview"
AZURE_OPENAI_GPT_AUDIO_MINI_FORMAT = "mp3"
AZURE_OPENAI_USE_V1_FORMAT = "true"

# ============================================================================
# Secrets Management
# ============================================================================
# Secrets are ENCRYPTED and not visible after setting them.
# Ref: https://developers.cloudflare.com/pages/functions/bindings/#secrets
#
# LOCAL DEVELOPMENT:
# - Create .dev.vars file (already exists, DO NOT COMMIT)
# - Format: SECRET_NAME=value (one per line)
#
# PRODUCTION DEPLOYMENT:
# Set secrets using wrangler CLI:
#
#   wrangler pages secret put AZURE_OPENAI_ENDPOINT --project-name=mystic-tarot
#   wrangler pages secret put AZURE_OPENAI_API_KEY --project-name=mystic-tarot
#   wrangler pages secret put AZURE_OPENAI_GPT5_MODEL --project-name=mystic-tarot
#   wrangler pages secret put AZURE_OPENAI_TTS_ENDPOINT --project-name=mystic-tarot
#   wrangler pages secret put AZURE_OPENAI_TTS_API_KEY --project-name=mystic-tarot
#   wrangler pages secret put AZURE_OPENAI_GPT_AUDIO_MINI_DEPLOYMENT --project-name=mystic-tarot
#
# PREVIEW ENVIRONMENT:
# For branch deployments, add --env=preview:
#
#   wrangler pages secret put AZURE_OPENAI_API_KEY --project-name=mystic-tarot --env=preview
#
# LIST SECRETS:
#   wrangler pages secret list --project-name=mystic-tarot
#
# DELETE SECRET:
#   wrangler pages secret delete AZURE_OPENAI_API_KEY --project-name=mystic-tarot
#
# Required Secrets for this project:
# - AZURE_OPENAI_ENDPOINT (Azure OpenAI endpoint URL)
# - AZURE_OPENAI_API_KEY (Azure OpenAI API key)
# - AZURE_OPENAI_GPT5_MODEL (Deployment name, e.g., "gpt-5.1" or "gpt-5.1-pro")
# - AZURE_OPENAI_TTS_ENDPOINT (TTS endpoint, can be same as above)
# - AZURE_OPENAI_TTS_API_KEY (TTS API key, can be same as above)
# - AZURE_OPENAI_GPT_AUDIO_MINI_DEPLOYMENT (TTS deployment name)

# ============================================================================
# Bindings
# ============================================================================
# Bindings connect your Functions to Cloudflare services.
# Ref: https://developers.cloudflare.com/pages/functions/bindings/
#

# D1 Database (for reading history, analytics):
[[d1_databases]]
binding = "DB"
database_name = "mystic-tarot-db"
database_id = "ede622bd-5845-4da9-9031-839cb26ae7be"

# KV namespace for TTS rate limiting (update IDs via `wrangler kv:namespace create`).
[[kv_namespaces]]
binding = "RATELIMIT"
id = "893bd9a5206d4719817c6c5dc0f1a409"
preview_id = "785db8a0b1824eb092b2a9107f9e48f3"

# ============================================================================
# Future Bindings (Currently Commented Out)
# ============================================================================
# Uncomment and configure as needed:
#
# KV Namespace (for caching readings, rate limiting):
# [[kv_namespaces]]
# binding = "TAROT_CACHE"
# id = "your-kv-namespace-id"
# preview_id = "your-preview-kv-namespace-id"
#
# R2 Bucket (for storing audio files):
# [[r2_buckets]]
# binding = "AUDIO_STORAGE"
# bucket_name = "mystic-tarot-audio"
# preview_bucket_name = "mystic-tarot-audio-preview"
#
# Durable Objects (must be created as separate Worker):
# [[durable_objects.bindings]]
# name = "READING_SESSION"
# class_name = "ReadingSession"
# script_name = "reading-session-worker"
#
# Analytics Engine:
# [[analytics_engine_datasets]]
# binding = "ANALYTICS"

# ============================================================================
# Local Development Settings
# ============================================================================
# Ref: https://developers.cloudflare.com/pages/functions/local-development/
#
# [dev]
# ip = "127.0.0.1"
# port = 8788
# local_protocol = "http"

# ============================================================================
# Compatibility Flags
# ============================================================================
# Enable Node.js compatibility if needed for imports
# [compatibility_flags]
# nodejs_compat = true
